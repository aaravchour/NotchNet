This article is about the mechanics of enchanting.

Whenever the player places an eligible item on the enchanting table, the enchantment levels available are randomly generated for each slot using the formula below. The enchantment level is dependent upon the number of nearby bookshelves (capped at 15) and which slot position it is in.

Base enchantment level available (base) = (randomInt(1,8) + floor(b / 2) + randomInt(0,b)),
where b is the number of nearby bookshelves (maximum of 15) and x..y generates a uniformly distributed random integer between x and y, inclusive. This is then modified according to the slot position:

Top slot enchantment level = floor(max(base / 3, 1))
Middle slot enchantment level = floor((base  2) / 3 + 1)
Bottom slot enchantment level = floor(max(base, b  2))
where max(x, y) returns the greater of two values x and y. 

Note that a higher experience cost for a specific slot does not necessarily mean that the enchantments from that slot are better than the others with less cost.
In Creative mode, no levels of experience are necessary for enchantments.

Nearby bookshelves raise the available enchantment levels; without any bookshelves, the experience level requirement never exceeds 8.
In order to have an effect, a bookshelf must be placed exactly 2 blocks, laterally, off the enchanting table and be on the same level or one block height above the table. Additionally, the bookshelf must not be blocked. The meaning of "blocked" differs on Java Edition and Bedrock Edition.

The 2-high space between the bookshelf and table must be air (even a torch, snow cover or carpet blocks the effect), where "between" is as shown in the following diagrams (the white spaces are air, and the  do not matter):

The space between the bookshelf and table, at the height of the bookshelf must be air or a replaceable block like snow or grass. For corner bookshelves, the space between is 1 block diagonal from the enchanting table; for all other bookshelves, the gap must be to the side of the enchanting table. This is illustrated in the following diagrams (the white spaces are air, and the  do not matter):

The glyph particles, which fly from bookshelves, follow different rules and may appear even if the bookshelves are not enhancing the table.
There are many possible bookshelf arrangements that can reach the enchantment limit. A simple method is to surround the enchanting table with a 1-block high square of bookshelves with an empty space anywhere on the perimeter:

Another alternative that is now available is to build a 'library corner' where each bookshelf is two blocks high, as in the plan below. This arrangement gives space for 16 shelves, which is one more than needed, so if the corner bookshelf column cannot be seen, removing one of the two bookshelves in that does not have any effect, either technically or visually.

As enchantments offered depend on the enchantment level and the enchantment level depends on the number of active bookshelves, an easy way to change the enchantments offered is to disable bookshelves by placing torches between them and the enchanting table. That way one can still have the entire 'ring' of bookshelves around the table but get lower-level enchantments. Breaking the torches restores the effect of the bookshelves.

With the layout shown here, enchantments with any number of bookshelves from 0 to 15 may be easily obtained:

With the layout shown here, enchantments with any number of bookshelves from 0 to 15 may be easily obtained:

"Enchantment level" is the required experience level (the green number on the bottom-right).
"Enchantment power" is the strength of the particular enchantment. For example, "Sharpness IV" has a power of 4.
The enchantment algorithm uses a three-step process.

The first thing that Minecraft does is apply two modifiers to the base enchantment level. Each modifier is restricted to a certain range, with numbers close to the middle of the range more common than those near the ends.
The first modifier is based on the item's "enchantability," which depends on the material and the type of the item (see the table below). Other enchantable items such as books, bows, crossbows, tridents, and fishing rods have an enchantability of 1 for this purpose. Minecraft picks a number between 0 and half the enchantability, then adds that number plus one to the enchantment level.  This random value follows a triangular distribution (like rolling a pair of dice and adding) so results close to a quarter of the enchantability are much more likely than results at the extremes.
The modified enchantment level is calculated with the following formula:

Modified enchantment level = B + R1 + R2 + 1
Where:

R1 and R2 are two individual randomly generated integers:
R1 = randomInt(0, floor(E / 4))
R2 = randomInt(0, floor(E / 4))
B is the base enchantment level.
E is the enchantability of the item.

Next, Minecraft picks a value between 0.85 and 1.15, again with a triangular distribution. The modified enchantment level is multiplied by this value (so it could increase or decrease by up to 15%) and then rounded to the nearest integer.

// Returns a uniformly distributed random integer between 0 and n1, inclusive
function randomInt(n);

// Returns a uniformly distributed random real (fractional) number between 0 (inclusive) and 1 (exclusive)
function randomFloat();

// Returns the real number n rounded to the nearest integer.
function round(n);

// Generate a random number between 1 and 1+(enchantability/2), with a triangular distribution
int rand_enchantability = 1 + randomInt(enchantability / 4 + 1) + randomInt(enchantability / 4 + 1);

// Choose the enchantment level
int k = chosen_enchantment_level + rand_enchantability;

// A random bonus, between .85 and 1.15
float rand_bonus_percent = 1 + (randomFloat() + randomFloat() - 1) * 0.15;

// Finally, we calculate the level
int final_level = round(k * rand_bonus_percent);
if ( final_level < 1 ) final_level = 1

The source is Minecraft 1.8 source code.

Now, based on the modified level, Minecraft makes a list of all enchantment types that can be applied to the target item along with the power that each enchantment has.
The power of each enchantment type is determined by the level and the values in the enchantments levels table. For each power value of an enchantment type, there is a minimum and maximum modified level that can produce the enchantment at that power. If the modified enchantment level (calculated at the first step) is within the range of an enchantment's possible power values, then the enchantment is assigned the modified enchantment level as power. If the modified level is within two overlapping ranges for the same enchantment type, the higher power value is used.

Some enchantments are "treasure enchantments" (shown in the table below), meaning they can never be created by an enchanting table, and can be discovered only in certain situations: when generating chest loot (equipment and books), when fishing, when generating enchanted book trades, when bartering, and when an enchanted book is dropped by a raiding illager.

Now that it has a list of the possible enchantments for the item, Minecraft must pick some of them to apply. Each enchantment has a statistical "weight". Enchantments with higher weights have a higher chance of being selected.
Minecraft uses the following weighted random selection algorithm:

Calculate the total weight of all enchantments in the list (T). The total of every enchantment is 136.
Pick a random integer from 0 to T  1 as a number w.
Iterate through each enchantment in the list, subtracting its weight from w. If w is now negative, select the current enchantment.
This algorithm produces the same results as listing each enchantment the number of times given by its weight, then choosing a random entry from the combined list.
So, for each enchantment in the list, the probability of it being selected is:

P = w/T
Where:

w is the enchantment's weight.
T is the total weight of all enchantments in the list.

Shields can be given the enchantments Unbreaking, Mending, Curse of Vanishing, and Curse of Binding by using Enchanted Books. 
The player always gets at least one enchantment on an item, and there is a chance of receiving more. Additional enchantments are chosen by this algorithm:

With probability (modified level + 1) / 50, keep going. Otherwise, stop picking bonus enchantments.
Remove from the list of possible enchantments anything that conflicts with previously-chosen enchantments.
Pick one enchantment from the remaining possible enchantments (based on the weights, as before) and apply it to the item.
Divide the modified level in half, rounded down (this does not affect the possible enchantments themselves, because they were all pre-calculated in Step Two).
Repeat from the beginning.
When enchanting books using an enchanting table, if multiple enchantments were generated, then one selected at random is removed from the final list. This does not apply to other sources of enchanted books that use enchantment mechanics, such as fishing or chests in generated structures.

Some enchantments conflict with other enchantments and thus both can't be enchanted into the same item, effectively taking down the possibility for one to get an overpowered weapon.
The rules for enchantment conflicts are:

Every enchantment conflicts with itself. (The player can't get a tool with two copies of the Efficiency enchantment.)
All damage enchantments (Sharpness, Smite, and Bane of Arthropods) conflict with each other.
All protection enchantments (Protection, Blast Protection, Fire Protection, Projectile Protection) conflict with each other.
Silk Touch conflicts with Fortune, Looting, and Luck of the Sea.
Depth Strider and Frost Walker conflict with each other.
Mending and Infinity conflict with each other.
Riptide conflicts with Loyalty and Channeling.
Multishot and Piercing conflict with each other.
Conflicting enchantments may appear on an item with specially-crafted /give commands. The behavior of such items should not be relied upon, but in general:

An item with multiple copies of the same enchantment uses the level of the first copy of that enchantment in the list.
For armor with conflicting protection enchantments, all enchantments take effect individually.
For weapons with conflicting damage enchantments, all enchantments take effect individually.
For tools with both Silk Touch and Fortune, Silk Touch takes priority over Fortune on blocks affected by both enchantments. Fortune still applies to blocks such as crops that are not affected by Silk Touch.
For bows with both Mending and Infinity, both enchantments work individually.
For tridents with both Loyalty and Riptide, Riptide still functions normally but the trident can no longer be thrown by the player. However, tridents can still be thrown using dispensers.
For crossbows with both Multishot and Piercing, both enchantments work individually.

There was a Web page for testing enchantments. While it no longer exists, it is still available on the WayBack Machine
This site provides some ability to test enchantments, although its interface is significantly less verbose on the specifics